{% comment %}
  Reviews Custom - Customer reviews showcase

  Features:
  - Horizontal scrolling review cards
  - Drag scroll functionality
  - Navigation arrows (desktop)
  - Configurable via blocks (manual mode)
  - Star rating display
  - Customer avatar, name, date
  - Product image
  - Optional verified purchase badge
  - Support for third-party review apps (placeholder)
{% endcomment %}

<section class="py-12 md:py-20 bg-white overflow-hidden relative select-none">

  {%- comment -%} Section Title {%- endcomment -%}
  <div class="max-w-[var(--custom-container-max-width)] mx-auto px-6 mb-8 md:mb-12">
    {%- if section.settings.title != blank -%}
      <h2 class="text-[24px] md:text-[36px] font-black text-[#1a1a1a] tracking-tight"
          style="font-family: var(--font-heading-family);">
        {{ section.settings.title }}
      </h2>
    {%- endif -%}
  </div>

  {%- comment -%} Reviews Container {%- endcomment -%}
  <div class="relative group" data-reviews-container>

    {%- comment -%} Left Navigation Arrow (Desktop) {%- endcomment -%}
    <div class="hidden lg:block absolute left-8 top-1/2 -translate-y-1/2 z-40 transition-opacity duration-300">
      <button class="reviews-nav-btn reviews-nav-left w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-[0_10px_30px_rgba(0,0,0,0.15)] hover:scale-110 active:scale-95 transition-all border border-gray-100"
              aria-label="Scroll left"
              data-scroll-direction="left">
        <svg class="w-6 h-6 text-[#1a1a1a]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
    </div>

    {%- comment -%} Right Navigation Arrow (Desktop) {%- endcomment -%}
    <div class="hidden lg:block absolute right-8 top-1/2 -translate-y-1/2 z-40 transition-opacity duration-300">
      <button class="reviews-nav-btn reviews-nav-right w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-[0_10px_30px_rgba(0,0,0,0.15)] hover:scale-110 active:scale-95 transition-all border border-gray-100"
              aria-label="Scroll right"
              data-scroll-direction="right">
        <svg class="w-6 h-6 text-[#1a1a1a]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    {%- comment -%} Reviews Scroll Container {%- endcomment -%}
    <div class="flex gap-3 md:gap-6 overflow-x-auto custom-hide-scrollbar px-6 pb-12 cursor-grab snap-x snap-mandatory"
         data-drag-scroll
         data-reviews-scroll>

      {%- comment -%} Review Cards Loop {%- endcomment -%}
      {%- for block in section.blocks -%}
        {%- liquid
          assign customer_name = block.settings.customer_name | default: 'Anonymous'
          assign customer_avatar = block.settings.customer_avatar
          assign rating = block.settings.rating | default: 5
          assign review_text = block.settings.review_text
          assign review_date = block.settings.review_date
          assign product_image = block.settings.product_image
          assign verified = block.settings.verified
        -%}

        <div class="flex-shrink-0 w-[84vw] sm:w-[320px] md:w-[380px] bg-white rounded-[2.2rem] md:rounded-[2.8rem] border border-gray-100 shadow-[0_12px_45px_rgba(0,0,0,0.06)] flex flex-col snap-center overflow-hidden"
             {{ block.shopify_attributes }}>

          {%- comment -%} Review Header (Avatar, Name, Date) {%- endcomment -%}
          <div class="p-4 md:p-6 flex items-center justify-between">
            <div class="flex items-center gap-2.5 md:gap-3">
              {%- if customer_avatar != blank -%}
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-gray-100 overflow-hidden bg-white flex items-center justify-center shadow-sm">
                  <img
                    src="{{ customer_avatar | image_url: width: 100 }}"
                    alt="{{ customer_name | escape }}"
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                </div>
              {%- else -%}
                {%- comment -%} Default avatar placeholder {%- endcomment -%}
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full border border-gray-100 bg-gray-100 flex items-center justify-center">
                  <svg class="w-5 h-5 md:w-6 md:h-6 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                </div>
              {%- endif -%}

              <div class="flex flex-col">
                <span class="font-black text-[14px] md:text-[16px] text-[#1a1a1a] tracking-tight">
                  {{ customer_name }}
                </span>
                {%- if verified -%}
                  <span class="text-[10px] md:text-[11px] font-bold text-green-600 tracking-tight flex items-center gap-1">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Verified Purchase
                  </span>
                {%- endif -%}
              </div>
            </div>

            {%- if review_date != blank -%}
              <span class="text-[11px] md:text-[12px] font-bold text-gray-400 tracking-tight">
                {{ review_date }}
              </span>
            {%- endif -%}
          </div>

          {%- comment -%} Product Image {%- endcomment -%}
          {%- if product_image != blank -%}
            <div class="w-full aspect-square md:aspect-[4/3] overflow-hidden bg-gray-50">
              <img
                src="{{ product_image | image_url: width: 800 }}"
                srcset="{{ product_image | image_url: width: 400 }} 400w,
                        {{ product_image | image_url: width: 800 }} 800w"
                sizes="(min-width: 640px) 380px, 84vw"
                class="w-full h-full object-cover"
                alt="Review photo"
                loading="lazy"
              />
            </div>
          {%- endif -%}

          {%- comment -%} Rating Stars {%- endcomment -%}
          <div class="px-5 md:px-6 pt-5 md:pt-6 pb-2 flex items-center justify-between">
            {%- if section.settings.show_feedback_emojis -%}
              <div class="flex gap-2.5 md:gap-3">
                <span class="text-xl md:text-2xl opacity-20 grayscale cursor-pointer hover:grayscale-0 hover:opacity-100 transition-all">üòä</span>
                <span class="text-xl md:text-2xl opacity-20 grayscale cursor-pointer hover:grayscale-0 hover:opacity-100 transition-all">üòê</span>
                <span class="text-xl md:text-2xl opacity-20 grayscale cursor-pointer hover:grayscale-0 hover:opacity-100 transition-all">‚òπÔ∏è</span>
              </div>
            {%- endif -%}

            <div class="flex gap-0.5 md:gap-1 {% if section.settings.show_feedback_emojis == false %}ml-auto{% endif %}">
              {%- for i in (1..5) -%}
                {%- if i <= rating -%}
                  <svg class="w-3.5 h-3.5 md:w-4.5 md:h-4.5 text-[var(--custom-color-accent)] fill-current" viewBox="0 0 24 24">
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                {%- else -%}
                  <svg class="w-3.5 h-3.5 md:w-4.5 md:h-4.5 text-gray-300 fill-current" viewBox="0 0 24 24">
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>

          {%- comment -%} Review Text {%- endcomment -%}
          {%- if review_text != blank -%}
            <div class="px-5 md:px-6 pb-8 md:pb-12">
              <p class="text-[#333] text-[14px] md:text-[15px] font-medium leading-relaxed mt-2 md:mt-3 custom-line-clamp-4">
                {{ review_text }}
              </p>
            </div>
          {%- endif -%}
        </div>

      {%- endfor -%}

      {%- comment -%} No Reviews Message {%- endcomment -%}
      {%- if section.blocks.size == 0 -%}
        <div class="w-full text-center py-12 text-gray-500">
          <p class="text-lg font-bold mb-2">No reviews yet</p>
          <p class="text-sm">Add review blocks in the theme customizer to display customer feedback.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

{%- comment -%} Load JavaScript for drag scroll and navigation {%- endcomment -%}
{%- comment -%} Using existing custom-product-card.js for drag scroll {%- endcomment -%}
<script src="{{ 'custom-reviews.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Reviews Custom",
  "tag": "section",
  "class": "reviews-custom-section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Riders' Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_feedback_emojis",
      "label": "Show feedback emojis",
      "default": false,
      "info": "Display emoji reaction buttons (üòäüòê‚òπÔ∏è)"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "limit": 20,
      "settings": [
        {
          "type": "header",
          "content": "Customer Information"
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer name",
          "default": "Anonymous"
        },
        {
          "type": "image_picker",
          "id": "customer_avatar",
          "label": "Customer avatar (optional)",
          "info": "If not provided, will show default avatar icon"
        },
        {
          "type": "text",
          "id": "review_date",
          "label": "Review date",
          "default": "2026/01/09",
          "info": "Format: YYYY/MM/DD or any text"
        },
        {
          "type": "checkbox",
          "id": "verified",
          "label": "Verified purchase",
          "default": false,
          "info": "Show 'Verified Purchase' badge"
        },
        {
          "type": "header",
          "content": "Review Content"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "label": "Star rating",
          "default": 5
        },
        {
          "type": "textarea",
          "id": "review_text",
          "label": "Review text",
          "info": "Customer's review comment"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product image (optional)",
          "info": "Image of the reviewed product or customer photo"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Reviews Custom",
      "settings": {
        "title": "Riders' Reviews",
        "show_feedback_emojis": false
      },
      "blocks": [
        {
          "type": "review",
          "settings": {
            "customer_name": "Maurizio R.",
            "review_date": "2025/11/07",
            "rating": 5,
            "review_text": "Beautiful ebike I love",
            "verified": true
          }
        },
        {
          "type": "review",
          "settings": {
            "customer_name": "Abdullatif A.",
            "review_date": "2025/10/31",
            "rating": 5,
            "review_text": "I work in food delivery in Nuremberg; the bike is excellent, very comfortable and fast; the design is one of the best I have seen; I give 10 stars as a rating for this bike.",
            "verified": true
          }
        },
        {
          "type": "review",
          "settings": {
            "customer_name": "Erik T.",
            "review_date": "2025/10/20",
            "rating": 5,
            "review_text": "Already during my first testride i was completely amazed by the bike. The updated Bafang M210 middrive motor has lot of power and gives with the torque sensor very smooth ride with direct response.",
            "verified": false
          }
        }
      ]
    }
  ]
}
{% endschema %}
